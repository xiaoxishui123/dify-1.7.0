# Dify项目备份使用指南

## 🚀 快速开始

### 第一步：测试备份系统
```bash
cd /home/dify
./backup_scripts/test_backup.sh
```

### 第二步：创建第一个备份
```bash
# 完整备份（推荐）
./backup_scripts/backup.sh

# 或者快速备份
./backup_scripts/quick_backup.sh
```

### 第三步：查看备份
```bash
./backup_scripts/manage_backups.sh list
```

## 📋 常用命令

### 备份操作
```bash
# 完整备份（包含所有数据）
./backup_scripts/backup.sh

# 快速备份（只备份核心数据）
./backup_scripts/quick_backup.sh
```

### 恢复操作
```bash
# 从备份恢复（会提示确认）
./backup_scripts/restore.sh <备份名称>
# 示例: ./backup_scripts/restore.sh dify_backup_20250725_143000
```

### 管理操作
```bash
# 查看所有备份
./backup_scripts/manage_backups.sh list

# 查看备份详情
./backup_scripts/manage_backups.sh info <备份名称>

# 删除备份
./backup_scripts/manage_backups.sh delete <备份名称>

# 清理旧备份（保留最近5个）
./backup_scripts/manage_backups.sh cleanup 5

# 查看备份总大小
./backup_scripts/manage_backups.sh size
```

## 🎯 使用场景

### 升级前备份
```bash
# 在升级Dify前，先创建完整备份
./backup_scripts/backup.sh
```

### 修改代码前备份
```bash
# 在修改代码前，创建快速备份
./backup_scripts/quick_backup.sh
```

### 定期备份
```bash
# 可以设置定时任务，每天自动备份
# 编辑crontab: crontab -e
# 添加: 0 2 * * * /home/dify/backup_scripts/backup.sh
```

### 数据恢复
```bash
# 如果出现问题，从备份恢复
./backup_scripts/restore.sh dify_backup_20250725_143000
```

## ⚠️ 重要提醒

### 备份前检查
- 确保Dify服务正常运行
- 检查磁盘空间充足
- 确保有足够权限

### 恢复前准备
- 恢复会覆盖当前数据
- 建议先备份当前数据
- 确认恢复目标正确

### 安全注意事项
- 备份包含敏感信息，请妥善保管
- 定期清理过期备份
- 建议将重要备份复制到其他位置

## 🔧 故障排除

### 备份失败
```bash
# 检查Docker服务状态
cd /home/dify/docker
docker compose ps

# 检查磁盘空间
df -h /home/dify

# 查看备份日志
tail -f /home/dify/backups/backup_info.txt
```

### 恢复失败
```bash
# 检查备份文件完整性
./backup_scripts/manage_backups.sh info <备份名>

# 检查Docker服务
docker compose ps

# 查看恢复日志
docker compose logs
```

## 📞 获取帮助

如果遇到问题，请：

1. 查看备份日志文件
2. 检查Docker服务状态
3. 验证备份文件完整性
4. 参考详细文档: `backup_scripts/README.md`

---

**创建时间**: 2025年7月25日  
**版本**: 1.0  
**维护者**: AI助手 